<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   
    <script
    src="https://code.jquery.com/jquery-3.5.1.js"
    integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous" onload="window.$ = window.jQuery = module.exports;"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script>
     
      const { ipcRenderer } = require('electron')
      document.config = JSON.parse(ipcRenderer.sendSync('config_init', ''))
      console.log(document.config)
      
      
      var syncdevices = setInterval(function(){
        synstate = ipcRenderer.sendSync('connecok', '')
        console.log(synstate)
        if(synstate == 1){
          $('#waitingmobile').modal("hide");
          clearInterval(syncdevices)
        }
      }, 500)


  </script>
    <title>FlashDeck</title>
    <style>
      .app_logo{
        height:5em
      }
      .card_btn{
    background-color: white;
    border-radius: 1em;
    width: 5em;
    height: 5em;
      }
      .card_btn:hover{
        background-color:#d3d3d3;
      }
      
      #haut{
margin-bottom:1em;
 }
#container_btn{
width:30em;
}
#result{
  margin:1em;
}
.text_icon{
  padding-top: 20%;
    position: relative;
    color:#424242;
}
    </style>
  </head>

  <body style="background-color:#424242;color:#FFF" onload="init()">
    <p><img alt="" class="app_logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CgogPGc+CiAgPHRpdGxlPmJhY2tncm91bmQ8L3RpdGxlPgogIDxyZWN0IGZpbGw9Im5vbmUiIGlkPSJjYW52YXNfYmFja2dyb3VuZCIgaGVpZ2h0PSI0MDIiIHdpZHRoPSI1ODIiIHk9Ii0xIiB4PSItMSIvPgogPC9nPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlLXdpZHRoPSIwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZT0iI2ZmZmZmZiIgZmlsbD0iI2ZmNmU2ZSIgaWQ9InN2Z18xIiBkPSJtMzMsOGwtMTIuMTU4LDBsLTYuODQyLDE0bDYsMGwtOCwxOGwyNCwtMTlsLTksMGw2LC0xM3oiIGNsYXNzPSJ2aS1wcmltYXJ5Ii8+CiAgPHBhdGggZmlsbD0iIzdmN2Y3ZiIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2Utd2lkdGg9IjAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlPSIjZmZmZmZmIiBpZD0ic3ZnXzIiIGQ9Im0yOC40MjEsMjcuMTA4Njk2bC0xNi40MjEsMTNsNS43NzgsLTEzbDEwLjY0MywweiIgY2xhc3M9InZpLWFjY2VudCIvPgogPC9nPgo8L3N2Zz4=" /><span>FlashDeck</span></p>

    <div class="container" id="container_btn">

      <div class="row" id="haut">
        <div class="col-sm">
    

         <div class="card_btn" onclick="openmodalto('1')">
          <center>
         <p class="text_icon" id="text_1"></p>
        </center>
        </div>

    
        </div>
        <div class="col-sm">
              <div class="card_btn" onclick="openmodalto('2')">
                <center>
                <p class="text_icon" id="text_2"></p>
              </center>
    </div>
        </div>
        <div class="col-sm">
              <div class="card_btn" onclick="openmodalto('3')">
                <center>
                <p class="text_icon" id="text_3"></p>
              </center>
    </div>
        </div>
        <div class="col-sm">
               <div class="card_btn" onclick="openmodalto('4')">
                <center>
                <p class="text_icon" id="text_4"></p>
              </center>
    </div>
        </div>
      </div>
    
      <div class="row" id="bas">
        <div class="col-sm">
             <div class="card_btn" onclick="openmodalto('5')">
              <center>
              <p class="text_icon" id="text_5"></p>
            </center>
    </div>
        </div>
        <div class="col-sm">
              <div class="card_btn" onclick="openmodalto('6')">
                <center>
                <p class="text_icon" id="text_6"></p>
              </center>
    </div>
        </div>
        <div class="col-sm">
              <div class="card_btn" onclick="openmodalto('7')">
                <center>
                <p class="text_icon" id="text_7"></p>
              </center>
    </div>
        </div>
        <div class="col-sm">
               <div class="card_btn" onclick="openmodalto('8')">
                <center>
                <p class="text_icon" id="text_8"></p>
              </center>
    </div>
        </div>
      </div>
    
    
    </div>
    
  

    <div class="modal fade"  data-backdrop="static" data-keyboard="false" style="color:#000" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="titlemodal">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Nom de la touche</p>

            <input type="text" class="form-control" id="nameoftouche" >
            <br>
           <p>Action de la touche</p>
            <select class="form-control" id="selectewheel" onchange="selectedchoose();">
              <option value="0">Ne Rien Faire</option>
              <option value="1">Ecrire une série de lettre</option>
              <option value="2">Ouvrir un programme</option>
              <option value="3">Jouer un son</option>     
              <option value="4">Contrôle Multimedia</option>
              <option value="5">Raccourci Clavier</option>          
            </select>
            <div id="result">

            </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Annuler</button>
            <button type="button" onclick="validate();" id="validatebutton"class="btn btn-success">Valider</button>
          </div> 
        </div>
      </div>
    </div>
  </div>



    <div class="modal fade" style="color:#000" id="waitingmobile" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title" id="fdgdg">En attente d'un appareil</h6>
             
           
          </div>
          <div class="modal-body">
            <center>
              <img alt="" style="height:2em" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBzdHlsZT0ibWFyZ2luOiBhdXRvOyBiYWNrZ3JvdW5kOiBub25lOyBkaXNwbGF5OiBibG9jazsgc2hhcGUtcmVuZGVyaW5nOiBhdXRvOyIgd2lkdGg9IjIxMXB4IiBoZWlnaHQ9IjIxMXB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiPgo8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMyNjIzMjMiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWRhc2hhcnJheT0iNDIuNzY0ODIxMzcwNDQyNzEgNDIuNzY0ODIxMzcwNDQyNzEiIGQ9Ik0yNC4zIDMwQzExLjQgMzAgNSA0My4zIDUgNTBzNi40IDIwIDE5LjMgMjBjMTkuMyAwIDMyLjEtNDAgNTEuNC00MCBDODguNiAzMCA5NSA0My4zIDk1IDUwcy02LjQgMjAtMTkuMyAyMEM1Ni40IDcwIDQzLjYgMzAgMjQuMyAzMHoiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3R5bGU9InRyYW5zZm9ybTpzY2FsZSgwLjg4KTt0cmFuc2Zvcm0tb3JpZ2luOjUwcHggNTBweCI+CiAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLWRhc2hvZmZzZXQiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjAuOTgwMzkyMTU2ODYyNzQ1MXMiIGtleVRpbWVzPSIwOzEiIHZhbHVlcz0iMDsyNTYuNTg4OTI4MjIyNjU2MjUiPjwvYW5pbWF0ZT4KPC9wYXRoPgo8IS0tIFtsZGlvXSBnZW5lcmF0ZWQgYnkgaHR0cHM6Ly9sb2FkaW5nLmlvLyAtLT48L3N2Zz4=" />
            
              <br><p>télécharger l'app :</p><img style="height:6em" src="https://chart.googleapis.com/chart?chs=150x150&cht=qr&chl=https://lamas.ga/download/deck.apk&choe=UTF-8">
              <br><small data-dismiss="modal">Fermer cette page</small>

            </center>
        </div>
      </div>
    </div>
  </div>


<script>
function list_refresh(){
for (var i = 1; i < 9; i++) {
$("#text_"+i).text(document.config[i].name)

}
list_refresh()

}

function init(){
  $('#waitingmobile').modal("show");
  list_refresh();
  
}
  
  
  var id_btn;
  var valueselect;
function openmodalto(id)
{
  id_btn = id;
  $('#exampleModal').modal("show")
  $("#titlemodal").text("Modifier le bouton "+id)
  $("#nameoftouche").val(document.config[id].name);
  $("#selectewheel").val(document.config[id].type)
  selectedchoose()
  $("#action").val(document.config[id].action)
  $("#listeninput").val(document.config[id].action)

  
 
}  

function selectedchoose(){
  console.log("ok")
  valueselect = $("#selectewheel").val();
  if(valueselect == 0){
    $("#result").html(``)
  }


  if(valueselect == 1){
    $("#result").html(`<input type="text" class="form-control" id="action" placeholder="Suite de touche">
    <br>
    <p class="important">Certain caractère ne sont pas disponible (é,è,ù etc)</p>
    `)
  }

  if(valueselect == 2){
    $("#result").html(`<input type="file" id="action" class="form-control-file" >`)
  }

  if(valueselect == 3){
    $("#result").html(`<input value="Ouvrir un son" id="action" type="file" accept="audio/mp3" class="form-control-file" >`)
  }
  if(valueselect == 4){
    $("#result").html(`
<div class="btn-group" role="group" aria-label="Basic example">
  <button type="button" onclick="multimediamode('1');" class="btn btn-secondary">V+</button>
  <button type="button" onclick="multimediamode('2');"class="btn btn-secondary">V-</button>
  <button type="button" onclick="multimediamode('3');"class="btn btn-secondary">⏮️</button>
  <button type="button" onclick="multimediamode('4');"class="btn btn-secondary">⏭</button>
  <button type="button" onclick="multimediamode('5');"class="btn btn-secondary">⏯️</button>
  <button type="button" onclick="multimediamode('6');"class="btn btn-secondary">Mute</button>
</div>
`)
  }

  if(valueselect == 5){
    $("#result").html(`
    <div class="input-group mb-3">
  <input type="text" class="form-control" id="listeninput" readonly onkeydown="listenkey(event)" placeholder="Touche clavier" aria-label="Recipient's username" aria-describedby="button-addon2">
  <div class="input-group-append">
    <input class="btn btn-outline-secondary"  id="startbutton" onclick="startlisten()" type="button" value="Saisi">

    </div>
</div>

`)
  }


}
var stps = 0;
var array;
function startlisten(){
  if(stps == 0){
document.querySelector('#startbutton').value = 'Arrêter';
document.querySelector("#listeninput").focus();

document.querySelector('#startbutton').classList.remove("btn-outline-secondary");
document.querySelector('#startbutton').classList.add("btn-outline-danger");
array = [];
stps = 1;
}else{
document.querySelector('#startbutton').value = 'Saisi';

document.querySelector('#startbutton').classList.remove("btn-outline-danger");
document.querySelector('#startbutton').classList.add("btn-outline-secondary");

stps = 0;
}



}
var bx;
function listenkey(event){
  var x = event.key;
  if (x != bx){
  bx=x;
  document.getElementById("listeninput").value = document.getElementById("listeninput").value + x + " - ";
  array.push(x);
  }
}
function multimediamode(id){
  multimediamodeid = id;
}
function validate(){
console.log(id_btn)
console.log(valueselect)
console.log($("#nameoftouche").val())
if(valueselect == 2 || valueselect == 3){
console.log(document.getElementById("action").files[0].path)
actionuri = document.getElementById("action").files[0].path
}else{
  actionuri = $("#action").val()
  console.log($("#action").val())
}
if(valueselect == 4){
  actionuri = multimediamodeid;
}
if(valueselect == 5){
  actionuri = array.toString();
}
document.config[id_btn].name = $("#nameoftouche").val();
document.config[id_btn].type = valueselect;
document.config[id_btn].action = actionuri;

$('#exampleModal').modal("hide")
list_refresh()




}
</script>
   <script>
      require('./renderer.js')
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>